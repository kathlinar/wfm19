<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Mainframe</title>

    <script src="js/vue.js"></script>
    <link type="text/css" rel="stylesheet" href="css/bootstrap.min.css"/>
    <link type="text/css" rel="stylesheet" href="css/bootstrap-vue.css"/>
    <link type="text/css" rel="stylesheet" href="css/vue-datetime.css"/>
    <link type="text/css" rel="stylesheet" href="css/util.css"/>
    <script src="js/axios.min.js"></script>
    <script src="js/bootstrap-vue.js"></script>
    <script src="js/luxon.js"></script>
    <script src="js/vue-datetime.js"></script>

</head>
<body>
<div id="app">
    <b-table id="table" style="padding-top: 3%; padding-left: 15%; padding-right: 15%" bordered outlined striped responsive
                 :fields="fields" :items="items" class="text-center">
        <template slot="cancel" scope="item">
            <b-btn class="text-center" size="sm" @click="cancel(item.item)">Cancel</b-btn>
        </template>
        <template slot="attend" scope="item">
            <b-btn class="text-center" size="sm" @click="attend(item.item)">Attend</b-btn>
        </template>
    </b-table>

    <b-modal id="cancellation" v-model="modalShow" title="Reservation" hide-footer>
        <div class="d-block text-center">
            <h4>{{cancelTxt}}</h4>
        </div>
    </b-modal>

</div>
</body>
<script>
    var vue = new Vue({
        el: '#app',
        data: {
            datetime: '',
            cancelTxt: '',
            modalShow: false,
            email: '',
            fields: {
                name:{
                    label: 'Name',
                    sortable: true
                },
                description: {
                    label: 'Description',
                    sortable: false
                },
                reservationDate: {
                    label: 'Reservation Date',
                    sortable: true
                },
                duration: {
                    label: 'Duration',
                    sortable: false
                },
                price:{
                    label: 'Price',
                    sortable: true
                },
                type:{
                    label: 'Type',
                    sortable: true
                },
                address: {
                    label: 'Address',
                    sortable: false
                },
                cancel:{
                    label: 'cancel',
                },
                attend: {
                    label: 'attend'
                }

            },
            items: [],
        },
        created() {
            this.baseUrl = window.location.origin + "/";
            var url = new URL(window.location.href);
            this.email = url.searchParams.get("email");
            axios.get(this.baseUrl + "getBookedExperiences/"+this.email).then(response => {
                this.items = response.data;
            });

        },
        methods:{
            cancel(item) {
                let _this = this;
                axios.post('/cancelReservation', {
                    date: item.reservationDate,
                    email: this.email,
                }).then(function (response) {
                    _this.cancelTxt = 'The cancellation of '+item.name+' was successfully';
                    _this.modalShow = true;
                })
                .catch(function (error) {
                    _this.cancelTxt = 'Their was an error on the cancellation of '+item.name;
                    _this.modalShow = true;
                });
            },
            attend(item){
                //TODO
                console.log(item)
            }

        }

    });
</script>
</html>